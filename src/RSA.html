<!DOCTYPE html>
<html lang="en">
<head>
    <title>RSA</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="jsencrypt.js"></script>
    <script src="jsencrypt.min.js"></script>
</head>
<body>

<div class="container">
    <center><h2>RSA encryption/ decryption DEMO : </h2></center></br>
    <div>
        <div class="form-group">
            <label for="private_key">Your private key :</label>
            <textarea class="form-control" id="private_key" placeholder="Private key" name="private_key"></textarea>
        </div>
        <div class="form-group">
            <label for="public_key">Public key:</label>
            <textarea class="form-control" id="public_key" placeholder="Public key" name="public_key"></textarea>
        </div>
        <div class="form-group">
            <label for="input">Input :</label>
            <textarea class="form-control" id="input" placeholder="Input" name="input"></textarea>
        </div>
        <center><div>
            <button type="submit" id="encrypt" class="btn btn-primary">Encrypt</button>
        </div></center>
        <div class="form-group">
            <label for="secret">Encrypted message : </label>
            <textarea class="form-control" id="secret"  placeholder="Encrypted message" name="secret"></textarea>
        </div>
        <center>
            <button type="submit" id="decrypt" class="btn btn-success">Decrypt</button>
            <button type="submit" id="download" class="btn btn-danger">Download</button>
        </center>
        <div class="form-group">
            <label for="secret_decrypted">Decrypted message : </label>
            <textarea class="form-control" id="secret_decrypted"  placeholder="Decrypted message" name="secret_decrypted"></textarea>
        </div>
    </div>
</div>
<script>
    function hex_to_ascii(str1)
    {
        var hex  = str1.toString();
        var str = '';
        for (var n = 0; n < hex.length; n += 2) {
            str += String.fromCharCode(parseInt(hex.substr(n, 2), 16));
        }
        return str;
    }
    
    function download(filename, text) {
        var element = document.createElement('a');
        element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
        element.setAttribute('download', filename);
        element.style.display = 'none';
        document.body.appendChild(element);
        element.click();
        document.body.removeChild(element);
    }

    $(document).ready(function() {
        $('#download').on('click', function() {
            var text = $('#secret').val();
            var filename = "encrypted_message.txt";
            download(filename, text);
        });


        $('#encrypt').on('click', function() {
            let message = [];
            let encrypted = [];

            let public_key = $('#public_key').val(); 
            let input = $('#input').val();

            var js_encrypt = new JSEncrypt();
            js_encrypt.setPublicKey(public_key);

            let size = input.length / 50 ;

            var regex = /.{1,50}/g;
            let new_message = input.match(regex)

            for( let i = 0 ; i< size ; i++ ) {
                message.push( js_encrypt.encrypt(new_message[i]) );
            }

            $('#secret').text(message.toString());
        });

        $('#decrypt').on('click', function() {
            let message = [];
            let encrypted = [];

            let secret = $('#secret').val();  
            let private_key = $('#private_key').val();

            var js_decrypt = new JSEncrypt();
            js_decrypt.setPrivateKey(private_key);

            let size = secret.length / 50 ;

            var regex = /.{1,50}/g;
            let new_message = secret.match(regex)

            for( let i = 0 ; i< size ; i++ ) {
                message.push( js_decrypt.decrypt(new_message[i]) );
            }

            $('#secret_decrypted').text(message.toString());
        });
    });
</script>
</body>

</html>
